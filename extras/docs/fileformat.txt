                       Gridmonger map file format
                       ==========================
                               Version 1


RIFF ('GRDM'          # Gridmonger map file
    LIST ('INFO'
        'INAM'        # Name
        'IART'        # Artist
        'ICMT'        # Comments
        'ICRD'        # Creation Date
        'ISFT'        # Software
    )
    LIST ('map '      # Map
        'prop'        # Map properties
        'coor'        # Global coordinate options
    )
    LIST ('lvls'      # List of levels (min=0, max=999)
        LIST ('lvl '  # Level
            'prop'    # Level properties
            'coor'    # Coordinate options
            'cell'    # Level cells
            'note'    # Notes
            'regn'    # Regions
            )
            ...
    )
    'lnks'            # Map links

    'stat'            # App state (optional)
)


'prop' (Map)
    UINT16  version
    WSTR    title             (minRuneLen=1, maxRuneLen=100)
    WSTR    game              (maxRuneLen=100)
    WSTR    author            (maxRuneLen=100)
    BSTR    creationTime      (len=19)
    WSTR    notes             (maxRuneLen=2000)


'coor'
    UINT8   origin            (0=northeast, 1=southeast)
    UINT8   rowStyle          (0=number, 1=letter)
    UINT8   columnStyle       (0=number, 1=letter)
    INT16   rowStart          (min=0, max=6666)
    INT16   columnStart       (min=0, max=6666)


'prop' (Level)
    WSTR    locationName      (minRuneLen=1, maxRuneLen=100)
    WSTR    levelName         (maxRuneLen=100)
    INT16   elevation         (min=-200, max=200)
    UINT16  numRows           (min=1, max=6666)
    UINT16  numColums         (min=1, max=6666)
    UINT8   overrideCoordOpts (0=off, 1=on)
    WSTR    notes             (maxRuneLen=2000)

'regn'
    UINT8   enableRegions     (0=off, 1=on)
    UINT16  rowsPerRegion     (min=2, max=3333)
    UINT16  columnsPerRegion  (min=2, max=3333)
    UINT16  numRegions

    numRegion times:
    UINT16  row*              (max=3332)
    UINT16  column*           (max=3332)
    WSTR    name              (minRuneLen=1, maxRuneLen=100)
    WSTR    notes             (maxRuneLen=2000)

    * row & column are not cell, but region coordinates


'cell'
    Cell data is stored in layers (similar in concept to bitmaps).
    Each layer can use a different compressions method.
    The data stored per layer, and the order of layers are as follows:

      UINT8   floor             (see Floor in common.nim for mappings)
      UINT8   floorOrientation  (0=horiz, 1=vert)
      UINT8   floorColor        (max=9)
      UINT8   wallNorth         (see Wall in common.nim for mappings)
      UINT8   wallWest          (see Wall in common.nim for mappings)
      UINT8   trail             (0=off, 1=on)

    Layer format:

      UINT8   compressionType

      if compressionType == 0 (uncompressed)
        uncompressed data as (numRows * numColums) bytes

      if compressionType == 1 (run-length encoded)
        UINT32   length     length of compressed data in bytes
        (UINT8 * length)    RLE compressed data

        The compression uses simple RLE encoding:

        - Values less than 0x80 are literal Values
        - Values greater than or equal to 0x80 are header values, followed
          by a single data byte. The lower 7-bits of the header is
          (repeatCount - 1); the data byte should be repeated repeatCount times.

      if compressionType == 2 (all zeros)
        no data; the whole layer should be filled with zeroes


'note'
    UINT16  numNotes          (max=10000)

    numNotes records of:

    UINT16  row               (max=numRows-1    of the given level)
    UINT16  column            (max=numColumns-1 of the given level)
    UINT8   kind

    if kind == 0 (comment)

    if kind == 1 (indexed)
        UINT16  index         (max=9999)
        UINT8   indexColor    (max=3)

    if kind == 2 (icon)
        UINT8   icon          (max=39, see NoteIcons in icons.nim for mappings)

    if kind == 3 (customId)
        BSTR    custom ID     (minLen=1, maxLen=2, only alphanumeric)

    if kind == 4 (label)
        UINT8   labelColor    (max=3)

    WSTR    text              (minRuneLen=1, maxRuneLen=400)


'lnks'
    UINT16  numLinks          (max=10000)

    numLinks records of:

    UINT16  srcLevel          (max=numLevels-1)
    UINT16  srcRow            (max=numRows-1    of the given level)
    UINT16  srcColumn         (max=numColumns-1 of the given level)

    UINT16  destLevel         (max=numLevel-1)
    UINT16  destRow           (max=numRows-1    of the given level)
    UINT16  destColumn        (max=numColumns-1 of the given level)


'stat'
    BSTR    themeName         (minLen=1, maxLen=200, only alphanumeric)

    UINT8   zoomLevel         (min=1, max=20)
    UINT8   currentLevel      (max=numLevels-1)
    UINT16  cursorRow         (max=numRows-1    of the given level)
    UINT16  cursorColumn      (max=numColumns-1 of the given level)
    UINT16  viewStartRow      (max=numRows-1    of the given level)
    UINT16  viewStartColumn   (max=numColumns-1 of the given level)

    UINT8   optShowCellCoords (0=off, 1=on)
    UINT8   optShowToolsPane  (0=off, 1=on)
    UINT8   optShowNotesPane  (0=off, 1=on)
    UINT8   optWasdMode       (0=off, 1=on)
    UINT8   optWalkMode       (0=off, 1=on)
    UINT8   optDrawTrail      (0=off, 1=on)

